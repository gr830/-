<div class="tasks-container">
  <h2>–ú–∏–Ω–∏ –ì–∞–Ω—Ç</h2>

  <div class="tasks-controls">
    <label>
      –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:
      <select [ngModel]="selectedResponsible" (ngModelChange)="onResponsibleChange($event)">
        <option value="0">–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</option>
        <option *ngFor="let r of responsibleList | slice:1" [value]="r.value">{{ r.label }}</option>
      </select>
    </label>
    <button (click)="generateResponsibleTasks()" [disabled]="selectedResponsible === -1">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å</button>
    <button (click)="goBack()">–ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º</button>
    <button *ngIf="selectedResponsible === 0" (click)="showExecutorSelection = !showExecutorSelection" class="executor-config-btn">
      {{ showExecutorSelection ? '–°–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏' : '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π' }}
    </button>
  </div>

  <div *ngIf="selectedResponsible === 0 && showExecutorSelection" class="executor-selection-panel">
    <h4>–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:</h4>
    <div class="executor-checkboxes">
      <label *ngFor="let r of responsibleList | slice:1" class="executor-checkbox">
        <input
          type="checkbox"
          [value]="r.value"
          [checked]="isExecutorSelected(r.value)"
          (change)="toggleExecutorSelection(r.value, $event)">
        {{ r.label }}
      </label>
    </div>
  </div>

  <div *ngIf="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>
  <div *ngIf="error" class="error-message">{{ error }}</div>

  <!-- Display for single selected responsible -->
  <div *ngIf="showTasksList && tasks.length > 0 && selectedResponsible !== 0 && !loading && !error" class="responsible-tasks-container">
    <div class="responsible-header">
      <div class="avatar-wrapper">
        <ng-container *ngIf="selectedResponsibleIcon; else initialsPlaceholder">
          <img [src]="selectedResponsibleIcon" alt="Responsible Avatar" class="avatar-img" />
        </ng-container>
        <ng-template #initialsPlaceholder>
          <div class="avatar-placeholder">{{ getInitials(getResponsibleName(selectedResponsible)) }}</div>
        </ng-template>
      </div>
      <h3>{{ getResponsibleName(selectedResponsible) }}</h3>
    </div>
    <ul class="tasks-list-horizontal">
      <ng-container *ngFor="let task of tasks; let i = index">
        <li *ngIf="task.endDatePlan" class="task-item" [class.last-task-item]="i === tasks.length - 1">
          <b>{{ task.title }}</b><br />
          <span *ngIf="task.startDatePlan">üö© –ù–∞—á–∞–ª–æ –ø–ª–∞–Ω: {{ formatDeadline(task.startDatePlan) }}</span>
          <!-- <br *ngIf="task.startDatePlan"/> -->
          <span>üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–ª–∞–Ω: {{ formatDeadline(task.endDatePlan) }}</span>
          <!-- <br /> -->
          <span *ngIf="task.durationPlan > 0">‚åõ –í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {{ task.durationPlan }} —á.</span><br />
          <span class="task-status" [style.background-color]="getStatusColor(getTaskStatusValue(task))">
            {{ getStatusLabel(getTaskStatusValue(task)) }}
          </span>
        </li>
      </ng-container>
    </ul>
    <div class="tasks-summary">
      <p *ngIf="lastTaskDueDate"><b>–ö—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–¥–∞—á–∏:</b> {{ lastTaskDueDate }}</p>
      <p><b>–û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:</b> {{ totalTasksDuration | number:'1.0-0' }} —á.</p>
      <p><b>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π:</b> {{ totalWorkingDays | number:'1.0-0'}} –¥.</p>
    </div>
  </div>

  <!-- Display for all responsibles -->
  <div *ngIf="showTasksList && allTasksByResponsible && selectedResponsible === 0 && !loading && !error">
    <div *ngFor="let responsibleEntry of getResponsibleEntries()" class="responsible-tasks-container">
      <div class="responsible-header">
        <div class="avatar-wrapper">
          <ng-container *ngIf="getResponsibleIcon(responsibleEntry.responsibleId); else initialsPlaceholder">
            <img [src]="getResponsibleIcon(responsibleEntry.responsibleId)" alt="Responsible Avatar" class="avatar-img" />
          </ng-container>
          <ng-template #initialsPlaceholder>
            <div class="avatar-placeholder">{{ getInitials(getResponsibleName(responsibleEntry.responsibleId)) }}</div>
          </ng-template>
        </div>
        <h3>{{ getResponsibleName(responsibleEntry.responsibleId) }}</h3>
      </div>
      <ul class="tasks-list-horizontal">
        <ng-container *ngFor="let task of responsibleEntry.tasks; let i = index">
          <li *ngIf="task.endDatePlan" class="task-item" [class.last-task-item]="i === responsibleEntry.tasks.length - 1">
            <b>{{ task.title }}</b><br />
            <span *ngIf="task.startDatePlan">üö© –ù–∞—á–∞–ª–æ –ø–ª–∞–Ω: {{ formatDeadline(task.startDatePlan) }}</span> 
            <!-- <br *ngIf="task.startDatePlan"/> -->
            <span>üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–ª–∞–Ω: {{ formatDeadline(task.endDatePlan) }}</span>
            <!-- <br /> -->
            <span *ngIf="task.durationPlan > 0">‚åõ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–Ω: {{ task.durationPlan }} —á.</span><br />
            <span class="task-status" [style.background-color]="getStatusColor(getTaskStatusValue(task))">
              {{ getStatusLabel(getTaskStatusValue(task)) }}
            </span>
          </li>
        </ng-container>
      </ul>
      <div class="tasks-summary">
        <p *ngIf="responsibleEntry.lastTaskDueDate"><b>–ö—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–¥–∞—á–∏:</b> {{ responsibleEntry.lastTaskDueDate }}</p>
        <p><b>–û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:</b> {{ responsibleEntry.totalTasksDuration | number:'1.0-0' }} —á.</p>
        <p><b>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π:</b> {{ responsibleEntry.totalWorkingDays | number:'1.0-0'}} –¥.</p>
      </div>
    </div>
  </div>

  <div *ngIf="showTasksList && tasks.length === 0 && selectedResponsible !== 0 && !loading && !error" class="no-tasks-message">
    –ó–∞–¥–∞—á–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
  </div>

  <div *ngIf="showTasksList && (!allTasksByResponsible || allTasksByResponsible.length === 0) && selectedResponsible === 0 && !loading && !error" class="no-tasks-message">
    –ó–∞–¥–∞—á–∏ –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
  </div>
</div>
