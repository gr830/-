<h2>Поиск задач</h2>
<button (click)="goBackToTasks()" style="background:linear-gradient(90deg, #179edc 0%, #50c878 100%);font-size:1.1rem;min-width:120px; margin-bottom: 20px;">Назад к задачам</button>

<div class="tasks-controls">
  <label>
    Поиск по названию:
    <input type="text" [(ngModel)]="searchTitle" placeholder="Введите название задачи..." (keydown.enter)="searchTasks()" />
    <button (click)="searchTasks()" style="background:linear-gradient(90deg,#50c878 0%,#179edc 100%);font-size:1.1rem;min-width:120px; ">Искать</button> 
  </label>
  <label>
    ID группы:
    <input type="number" [(ngModel)]="groupId" placeholder="Введите ID группы (по умолчанию 174)" />
  </label>
  <label>
    Статус:
    <select [(ngModel)]="selectedStatus">
      <option *ngFor="let status of statusList" [ngValue]="status.value">{{ status.label }}</option>
    </select>
  </label>
  <label>
    Дедлайн от:
    <input type="date" [(ngModel)]="deadlineFrom" />
  </label>
  <label>
    Дедлайн до:
    <input type="date" [(ngModel)]="deadlineTo" />
  </label>
  <button (click)="clearDeadlineFilter()">Сбросить дедлайн</button>
  
</div>

<div *ngIf="loading">Загрузка...</div>
<div *ngIf="error" class="error-message">{{ error }}</div>

<div *ngIf="totalCalculatedHours > 0" class="total-time-display">
  <h3>Общее время по найденным задачам:</h3>
  <span><b>Часов:</b> {{ totalCalculatedHours | number:'1.0-0' }} ч. </span>
  <span><b> Дней:</b> {{ totalCalculatedDays | number:'1.0-0' }} д. (на одного человека) </span>
</div>

<div *ngIf="!loading && !error && tasks.length > 0" class="search-results">
  <div *ngFor="let task of tasks" class="search-result-card">
    <h3>{{ task.title }}</h3>
    <p *ngIf="task.description"><b>Описание:</b> {{ task.description }} </p>
    <p><b>Статус:     </b> <span class="task-status" [style.background-color]="getStatusColor(getTaskStatusValue(task))">{{ getStatusLabel(getTaskStatusValue(task)) }}</span></p>
    <p *ngIf="task.responsible"><b>Исполнитель:</b> {{ task.responsible.name === "Владислав Боднарь" ? "Задача не распределена" : task.responsible.name === "Алексей Зубрицкий" ? "Производственный цех" : task.responsible.name }} </p>

    <p *ngIf="task.durationPlan"><b>Продолжительность:</b> {{ task.durationPlan }} ч.</p>
    <p *ngIf="task.deadline"><b>Дедлайн:</b> {{ formatDeadline(task.deadline) }}</p>
    <p *ngIf="task.startDatePlan"><b>Начало план:</b> {{ formatDeadline(task.startDatePlan) }}</p>
    <p *ngIf="task.endDatePlan"><b>Завершение план:</b> {{ formatDeadline(task.endDatePlan) }}</p>
  </div>
</div>

<div *ngIf="!loading && !error && tasks.length === 0" style="text-align: center; margin-top: 20px;">
  <p>Задачи не найдены.</p>
</div>

<div style="text-align:center;" class="pagination-controls">
  <button (click)="prevPage()" [disabled]="page === 1">Назад</button>
  <span>Страница {{ page }} (показано {{ tasks.length }} из {{ total }})</span>
  <button (click)="nextPage()" [disabled]="page * pageSize >= total">Вперёд</button>
</div>
