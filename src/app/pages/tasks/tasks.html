<h2>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h2>
<button (click)="logout()">–í—ã–π—Ç–∏</button>

<div class="tasks-controls">
  <label>
    –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:
    <select [value]="selectedStatus" (change)="onStatusChange($event)">
      <option *ngFor="let status of statusList" [value]="status.value">{{ status.label }}</option>
    </select>
  </label>
  <label>
    –û—Ç–¥–µ–ª:
    <select [ngModel]="selectedGroup" (ngModelChange)="onGroupChange($event)">
      <option *ngFor="let group of groupList" [value]="group.value">{{ group.label }}</option>
    </select>
  </label>
  <label>
    –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:
    <select [ngModel]="selectedResponsible" (ngModelChange)="onResponsibleChange($event)">
      <option *ngFor="let r of responsibleList" [value]="r.value">{{ r.label }}</option>
    </select>
  </label>
  <label>
    –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é:
    <input type="text" [value]="search" (input)="onSearchChange($event)" placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è..." />
  </label>
  <label>
    –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
    <select [ngModel]="sortField" (ngModelChange)="onSortChange($event)">
      <option *ngFor="let sort of sortList" [value]="sort.value">{{ sort.label }}</option>
    </select>
    <select [ngModel]="sortDirection" (ngModelChange)="onSortDirectionChange($event)">
      <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
      <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
    </select>
  </label>
  <label>
    –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
    <select [(ngModel)]="selectedRefresh" (ngModelChange)="onRefreshChange($event)">
      <option *ngFor="let interval of refreshIntervals" [value]="interval.value">{{ interval.label }}</option>
    </select>
  </label>
  <label>
     –ü–ª–∞–Ω –æ—Ç (–≤–∫–ª—é—á–∞—è):
    <input type="date" [value]="deadlineFrom" (change)="onDeadlineFromChange($event)" />
  </label>
  <label>
     –ü–ª–∞–Ω –¥–æ (–≤–∫–ª—é—á–∞—è):
    <input type="date" [value]="deadlineTo" (change)="onDeadlineToChange($event)" />
  </label>
  <button (click)="clearDeadlineFilter()">–°–±—Ä–æ—Å–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω</button>
  <button (click)="manualRefresh()" style="background:linear-gradient(90deg,#50c878 0%,#179edc 100%);font-size:1.1rem;min-width:120px;">–û–±–Ω–æ–≤–∏—Ç—å</button>
  <button (click)="goToSearch()" style="background:linear-gradient(90deg, #179edc 0%, #50c878 100%);font-size:1.1rem;min-width:120px;">–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á</button>
  <button (click)="goToAnalytics()" style="background:linear-gradient(90deg, #179edc 0%, #50c878 100%);font-size:1.1rem;min-width:120px;">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
  <button (click)="goToResponsibleTasks()" style="background:linear-gradient(90deg, #179edc 0%, #50c878 100%);font-size:1.1rem;min-width:120px;">–ì–∞–Ω—Ç</button>
</div>

<div *ngIf="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
<div *ngIf="error" class="error-message">{{ error }}</div>

<div *ngIf="!loading && !error">
  <div style="margin: 10px 5px; text-align:center;">
    <button style="margin: 5px;" (click)="prevPage()" [disabled]="page === 1">–ù–∞–∑–∞–¥</button>
    <span> –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} (–ø–æ–∫–∞–∑–∞–Ω–æ {{ filteredTasks().length }} –∏–∑ {{ total }}) </span>
    <button  style="margin: 5px;" (click)="nextPage()" [disabled]="page * 50 >= total">–í–ø–µ—Ä—ë–¥</button>
  </div>
  <div class="tasks-columns">
    <div *ngFor="let name of (groupedTasks | keyvalue)" class="tasks-column">
      <div class="avatar-wrapper">
        <ng-container *ngIf="name.value[0]?.responsible?.icon; else initials">
          <img [src]="name.value[0].responsible.icon" alt="avatar" class="avatar-img" />
        </ng-container>
        <ng-template #initials>
          <div class="avatar-placeholder">{{ getInitials(name.key) }}</div>
        </ng-template>
      </div>
      <h3>{{ name.key }}</h3>
      <ul>
        <li *ngFor="let task of name.value">
          <b>{{ task.title }}</b><br /><br *ngIf="task.startDatePlan"/>
          <span *ngIf="task.startDatePlan">üö© –ù–∞—á–∞–ª–æ –ø–ª–∞–Ω: {{ formatDeadline(task.startDatePlan) }}</span>
          <span *ngIf="task.endDatePlan" [style.color]="isOverdue(task) &&  task.status != 5 ? '#d32f2f' : 'inherit'">üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–ª–∞–Ω: {{ formatDeadline(task.endDatePlan) }}</span>
          <span> üìÖ –î–µ–¥–ª–∞–π–Ω: {{ formatDeadline(task.deadline) }}</span>
          <span *ngIf="task.durationPlan > 0">‚åõ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–Ω: {{ task.timeEstimate === task.durationPlan ? task.durationPlan / 3600 + " —á." : task.durationPlan + " —á." }} </span><br />
          <span class="task-status" [style.background-color]="getStatusColor(getTaskStatusValue(task))">
            {{ getStatusLabel(getTaskStatusValue(task)) }}
          </span>
        </li>
      </ul>
    </div>
  </div>
</div>

<button
  *ngIf="showScrollDown"
  (click)="scrollDown()"
  class="scroll-down-btn"
  aria-label="–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–Ω–∏–∑"
>
  ‚Üì
</button>
